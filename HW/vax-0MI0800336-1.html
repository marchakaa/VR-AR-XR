<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="importmap">
        {
			"imports": {
			  "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
			  "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/",
			  "vax": "https://boytchev.github.io/CourseVAX/lib/vax.js"
		    }
		}
    </script>
    
</head>
<body>
    <script type="module">
        import * as THREE from 'three';
		import * as TWEEN from "three/addons/libs/tween.module.js";
        import {vaxInit, scene, camera} from 'vax';
        vaxInit(frame);
        scene.background = new THREE.Color().setHSL(0.5, 0.5, 0.5);

        let COLOR_RED = 0xB82E14;

        let floor = new THREE.Mesh(new THREE.BoxGeometry(60, 2, 60), new THREE.MeshBasicMaterial({color: 'green'}));
        // floor.position.y = -30;
        scene.add(floor);

        let rooster = new THREE.Group();
        scene.add(rooster);

        let body = new THREE.Group();
        rooster.add(body);
        let bodyRed = new THREE.Mesh(new THREE.BoxGeometry(8,5,5), new THREE.MeshPhongMaterial({color: COLOR_RED}));
        let bodyBlack = new THREE.Mesh(new THREE.BoxGeometry(8,1,5), new THREE.MeshPhongMaterial({color: 'black'}));
        let preLegs = new THREE.Mesh(new THREE.BoxGeometry(6,0.5,5), new THREE.MeshPhongMaterial({color: 0x312922}));
        bodyRed.position.y = 0.5;
        bodyBlack.position.y = -2.5;
        preLegs.position.y = -3.25;
        
        // let neckRed = new THREE.Mesh(new THREE.BoxGeometry(1, 3, 4), new THREE.MeshPhongMaterial({color: COLOR_RED}));
        let neckBlack = new THREE.Mesh(new THREE.BoxGeometry(1, 6, 4), new THREE.MeshPhongMaterial({color: 'black'}));
        // neckRed.position.set(-4.5, 4.5, 0);
        neckBlack.position.set(-4.5, 0, 0);

        let head = new THREE.Mesh(new THREE.BoxGeometry(4, 4, 3), new THREE.MeshPhongMaterial({color: COLOR_RED}));
        head.position.set(-4, 5, 0);

        for (let index = 0; index < 2; index++) {
            let eye = new THREE.Mesh(new THREE.SphereGeometry(1, 16, 16), new THREE.MeshPhongMaterial({color: 'black'}));
            eye.position.set(-4.5, 5.5, 0.75 - index*1.5);
            body.add(eye);
        }
        let beakTop = new THREE.Mesh(new THREE.ConeGeometry(1, 2, 2, 1, true, 0, Math.PI), new THREE.MeshPhongMaterial({color: 'orange', side: THREE.DoubleSide}));
        let beakBottom = new THREE.Mesh(new THREE.ConeGeometry(1, 2, 2, 1, true, 0, Math.PI), new THREE.MeshPhongMaterial({color: 'orange', side: THREE.DoubleSide}));
        beakTop.scale.z = 0.75;
        beakBottom.scale.z = 0.75;
        beakTop.rotation.z += Math.PI/2;
        beakBottom.rotation.z += Math.PI/2;
        beakBottom.rotation.x += Math.PI;
        beakTop.position.set(-7, 4.5, 0);
        beakBottom.position.set(-7, 4.5, 0);

        for (let index = 0; index < 8; index++) {
            let comb = new THREE.Mesh(new THREE.BoxGeometry(0.2, 2, 0.3), new THREE.MeshPhongMaterial({color: 'red'}));
            comb.scale.y = THREE.MathUtils.randFloat(0.5, 1);
            comb.position.set(-6.1, 2.5 + THREE.MathUtils.randFloat(0, 0.5), THREE.MathUtils.randFloat(-1, 1));
            body.add(comb);
        }

        let height = 1;
        for (let index = 0; index < 3; index++) {
            let crest = new THREE.Mesh(new THREE.BoxGeometry(1, height, 0.5), new THREE.MeshPhongMaterial({color: 'red'}));
            crest.position.set(-5.8 + index*1.3, 7.2 + height/2, 0);
            body.add(crest);
            height += THREE.MathUtils.randFloat(0.1, 0.3);
        }

        let headBand = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 2), new THREE.MeshPhongMaterial({color: 'red'}));
        headBand.position.set(-4, 7.1, 0);

        let faceBand = new THREE.Mesh(new THREE.BoxGeometry(0.01, 2, 1.5), new THREE.MeshPhongMaterial({color: 'red'}));
        faceBand.position.set(-6.005, 6, 0);

        let wings = [];
        for (let index = 0; index < 2; index++) {
            let wing = new  THREE.Mesh(new THREE.CylinderGeometry(3, 3, 0.4, 3, 1), new THREE.MeshPhongMaterial({color: COLOR_RED}));
            wing.position.z = 2.7 - index*2.7*2;
            wing.rotation.x += Math.PI/2;
            wing.rotation.y += Math.PI/6;
            wings.push(wing);
            body.add(wing);
            
        }

        body.add(bodyRed, bodyBlack, neckBlack, head, beakTop, beakBottom, headBand, preLegs, faceBand);


        let legs = new THREE.Group();
        rooster.add(legs);
        for (let index = 0; index < 2; index++) {
            let leg = new THREE.Group();
            let blackPart = new THREE.Mesh(new THREE.BoxGeometry(1.2, 2, 1.2), new THREE.MeshPhongMaterial({color: 'black'}));
            blackPart.rotation.z += Math.PI/4;
            blackPart.position.set(-1.3, -4, 0);
            let stickLeg = new THREE.Mesh(new THREE.BoxGeometry(0.8, 3, 0.8), new THREE.MeshPhongMaterial({color: 'grey'}));
            stickLeg.position.y = -5;
            stickLeg.rotation.z -= Math.PI/6;
            stickLeg.position.set(-2.2, -5.5, 0);
            let finger1 = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.2, 0.3), new THREE.MeshPhongMaterial({color: 'grey'}));
            finger1.position.set(-3.5, -6.5, 0);
            let finger2 = finger1.clone();
            finger2.rotation.y += Math.PI/6;        
            finger2.position.set(-3.5, -6.5, 0.2);
            let finger3 = finger1.clone();
            finger3.rotation.y -= Math.PI/6;        
            finger3.position.set(-3.5, -6.5, -0.2);
            let finger4 = finger1.clone();
            finger4.rotation.z -= Math.PI/4;
            finger4.position.set(-2.5, -7, 0);

            leg.add(blackPart, stickLeg, finger1, finger2, finger3, finger4);
            leg.position.z = -1.3 + 2.6*index;
            // leg.position.x = 1;
            legs.add(leg);
        }

        let tail = new THREE.Group();
        body.add(tail);
        const FEATHER_COUNT = 15;
        for (let index = 0; index < FEATHER_COUNT; index++) {
            let pos = new THREE.Vector3(THREE.MathUtils.randFloat(4, 5), THREE.MathUtils.randFloat(1, 4.5), THREE.MathUtils.randFloat(-1.5, 1.5));
            let tailFeather = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 1), new THREE.MeshPhongMaterial({color: 0x312922}));
            tailFeather.position.copy(pos);
            tailFeather.rotation.z += Math.PI/4;
            let tailFeather2 = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 1), new THREE.MeshPhongMaterial({color: 0x312922}));
            tailFeather2.position.copy(pos);
            tailFeather2.position.x += 1+2;
            tailFeather2.position.y += 1;
            let tailFeather3 = new THREE.Mesh(new THREE.BoxGeometry(3, 0.2, 1), new THREE.MeshPhongMaterial({color: 0x312922}));
            tailFeather3.position.copy(pos);
            tailFeather3.rotation.z -= Math.PI/4;
            tailFeather3.position.x += 1+4+0.75;
            tail.add(tailFeather, tailFeather2, tailFeather3);
            
        }


        const GRASS_COUNT= 1000;
        for (let index = 0; index < GRASS_COUNT; index++) {
            let grass = new THREE.Mesh(new THREE.BoxGeometry(0.1, 6, 0.1), new THREE.MeshPhongMaterial({color: 'green'}));
            grass.rotation.x += Math.PI/THREE.MathUtils.randFloat(4, 6);
            grass.rotation.y += Math.PI/THREE.MathUtils.randFloat(4, 6);
            grass.position.set(THREE.MathUtils.randInt(-30, 30), 3, THREE.MathUtils.randInt(-30, 30));
            scene.add(grass);
        }

        rooster.rotation.y += Math.PI/2;
        rooster.rotation.z += 0.3;
        rooster.position.y = 9;
        camera.position.y = 20;
        camera.position.z = 60;

        const duration = 1000;
        for (let index = 0; index < wings.length; index++) {
            let tween1 = new TWEEN.Tween(wings[index].rotation).to({z: (1-2*index)*Math.PI/4}, duration);   
            let tween2 = new TWEEN.Tween(wings[index].rotation).to({z: 0}, duration);

            tween1.chain(tween2);
            tween2.chain(tween1);

            tween1.start();
            
        }

        function frame(t) {
            rooster.rotation.y = Math.sin(t/2)*2;
            body.rotation.z = Math.sin(t/2);
            TWEEN.update();
            // beakTop.rotation.z = Math.sin(t/2);
        }
    </script>    
</body>
</html>